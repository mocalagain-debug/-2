<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä»“åº“æ™ºèƒ½ç®¡ç†ç³»ç»Ÿ - æ•´åˆç‰ˆ</title>
    <style>
        :root { --primary: #007bff; --success: #28a745; --danger: #dc3545; --warning: #ffc107; }
        body { font-family: -apple-system, sans-serif; background-color: #f4f7f6; margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .container { width: 100%; max-width: 900px; }
        h1 { text-align: center; color: #333; font-weight: 300; margin-bottom: 30px; }
        
        /* é¡¶éƒ¨æ“ä½œåŒº */
        .controls { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 10px; margin-bottom: 20px; }
        button { padding: 12px; border: none; border-radius: 8px; color: white; cursor: pointer; font-size: 14px; transition: 0.2s; font-weight: 500; }
        .btn-blue { background: var(--primary); }
        .btn-green { background: var(--success); }
        .btn-info { background: #17a2b8; }
        .btn-return { background: var(--warning); color: #333; }
        
        /* å½•å…¥é¢æ¿ */
        .panel { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); margin-bottom: 20px; display: none; }
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        input { padding: 12px; border: 1px solid #ddd; border-radius: 6px; outline: none; }
        .full-width { grid-column: span 2; }

        /* æœç´¢æ¡† */
        .search-group { margin-bottom: 20px; }
        #searchInput { width: 100%; padding: 18px 25px; border: none; border-radius: 30px; box-shadow: 0 8px 20px rgba(0,0,0,0.1); font-size: 18px; box-sizing: border-box; outline: none; border: 2px solid transparent; }
        #searchInput:focus { border-color: var(--primary); }

        /* è¡¨æ ¼æ ·å¼ */
        .table-wrapper { background: white; border-radius: 12px; overflow-x: auto; box-shadow: 0 2px 8px rgba(0,0,0,0.05); display: none; }
        table { width: 100%; border-collapse: collapse; min-width: 600px; }
        th { background: #f8f9fa; padding: 15px; text-align: left; font-size: 13px; color: #666; border-bottom: 2px solid #eee; }
        td { padding: 12px 15px; border-bottom: 1px solid #eee; font-size: 14px; }
        .loc-tag { background: #eee; padding: 2px 6px; border-radius: 4px; font-family: monospace; font-weight: bold; }
        .highlight { background: #fff3cd; }
        .status-returned { color: #aaa; text-decoration: line-through; }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ“¦ ä»“åº“æ™ºèƒ½ç®¡ç†ç³»ç»Ÿ</h1>

    <div class="controls">
        <button class="btn-blue" onclick="togglePanel('inputPanel')">â• æ–°å¢å½•å…¥</button>
        <button class="btn-green" onclick="showTotalStats()">ğŸ“Š åº“å­˜æ€»è®¡</button>
        <button class="btn-info" onclick="showBorrowList()">ğŸ“‹ å€Ÿè¿˜æ˜ç»†è¡¨</button>
    </div>

    <div id="inputPanel" class="panel">
        <div class="form-grid">
            <input type="text" id="newLoc" placeholder="åº“ä½ (å¦‚: 1-1)">
            <input type="text" id="newName" placeholder="é›¶ä»¶åç§°">
            <input type="text" id="newNo" placeholder="é›¶ä»¶å·">
            <input type="number" id="newQty" placeholder="æ•°é‡">
            <input type="text" id="newNote" class="full-width" placeholder="å¤‡æ³¨">
            <button class="btn-green full-width" onclick="savePart()">ä¿å­˜åˆ°ä»“åº“</button>
        </div>
    </div>

    <div class="search-group">
        <input type="text" id="searchInput" placeholder="è¾“å…¥é›¶ä»¶åã€é›¶ä»¶å·æˆ–åº“ä½å¼€å§‹æœç´¢..." oninput="handleSearchInput()">
    </div>

    <div id="tableContainer" class="table-wrapper">
        <table id="mainTable">
            <thead id="tableHead"></thead>
            <tbody id="tableBody"></tbody>
        </table>
    </div>
</div>

<script>
// 1. æ•°æ®åˆå§‹åŒ– (ä¼˜å…ˆè¯»å–æœ¬åœ°å­˜å‚¨ï¼Œå¦åˆ™åŠ è½½ä½ æä¾›çš„272æ¡åŸå§‹æ•°æ®)
let database = JSON.parse(localStorage.getItem('parts_db')) || [
    ["1-1","æ²¹æ»¤èŠ¯","026W32831-000","4",""],["1-1","é˜€","955A0040H06","1",""],["1-1","å«ç‰‡","028-14434-000","2",""],["1-1","å«ç‰‡","028-14433-000","1",""],["1-1","å«ç‰‡","029-22714-000","1",""],["1-1","çº¿æŸ","571W06854-271","1",""],["1-2","å‹åŠ›ä¼ æ„Ÿå™¨","025W47072-006","1",""],["1-2","ç”µæ± ","025W39729-000","3",""],["1-2","æ¥å¤´","023W25397-000","2",""],["1-2","å¡æ‰£","021G00072A007","2",""],["1-2","ç»§ç”µå™¨åº•åº§","024W33829-032","3",""],["1-2","è¾…åŠ©è§¦ç‚¹","024W33857-381","7",""],["1-2","å‹åŠ›ä¼ æ„Ÿå™¨","025W40088-000","1",""],["1-2","å‹å·®å¼€å…³åº•åº§","073W44110-000","1",""],["1-2","å‹å·®æ°´æµå¼€å…³","024W33848-000","1",""],["1-2","æ¸©åº¦ä¼ æ„Ÿå™¨","025W48195-101","1",""],["1-2","çƒé˜€","022W13503-000","2",""],["1-2","æ°´å®¤å«åœˆ","092W18800-007","1",""],["1-2","æ°´å®¤å«åœˆ","092W18800-008","1",""],["1-3","è§’é˜€","022-09756-000","1",""],["1-3","ç”µæº","025-34111-000","1",""],["1-3","è½¯ç®¡","028W17886-002","12",""],["1-3","è½¯ç®¡","028W17771-000","12",""],["1-3","æ¸©åº¦ä¼ æ„Ÿå™¨","028W48195-001","1",""],["1-3","æ¶²ä½æ‰§è¡Œå™¨","025W38177-001","2",""],["1-4","æ¶²ä½æ‰§è¡Œå™¨","025W38178-001","1",""],["1-4","é«˜å‹å¼€å…³","225-27165-002","1",""],["1-4","å‹å·®å¼€å…³","024G00018-008","1",""],["1-4","å«ç‰‡","028W15785-013","1",""],["1-5","å¯¼å¶é©¬è¾¾","025W48234-000","1",""],["1-5","ç”µæœºé£ç›˜","1051943","1",""],["1-5","è¿‡æ»¤å™¨","026-32839-000","4",""],["2-1","è¿‡æ»¤å™¨","026W37563-001","4",""],["2-1","è¿‡æ»¤å™¨","026-32839-000","2",""],["2-1","ä¸»æ¿","331-02430-601","1",""],["2-1","å†·å´æ¶²","013-04129-000","1",""],["2-1","ä¼ æ„Ÿå™¨","534D1251H03","1",""],["2-2","å¡æ‰£","021w34347-000","3",""],["2-2","è¿‡æ»¤å™¨","026-18328-000","8",""],["2-4","è§¦å‘æ¿","031-02060-002","2",""],["2-4","å†·å´æ¶²","013-04129-000","1",""],["2-4","æµ®çƒå¼€å…³","","8",""],["2-5","æ™¶æ¾³ç»„ä»¶","","1ç®±",""],["3-1","æ²¹æ»¤èŠ¯","026W32831-000","7",""],["3-1","è½´å°","534C1325H03","1",""],["3-1","è½´å°","534C1325H02","1",""],["3-1","åŠ æ¹¿å™¨ç”µæ§ç®±","026G63000-089","1",""],["3-2","å¹²ç‡¥è¿‡æ»¤å™¨","026W37563-001","1",""],["3-2","å¹²ç‡¥è¿‡æ»¤å™¨","026-37563-000","1",""],["3-2","æ²¹åŠ çƒ­å™¨","025W00084-000","1",""],["3-2","æ°´å®¤å¯†å°å«","092W09935-001","2",""],["3-2","ä¸»æ¿","024W33745-000","2",""],["3-2","VGDæ§åˆ¶æ¿","031-02418-001","1",""],["3-2","ç”µå®¹","025-35972-000","3",""],["3-2","å‹åŠ›ä¼ æ„Ÿå™¨","025W40088-000","1",""],["3-2","æ¸©åº¦ä¼ æ„Ÿå™¨","025W29964-000","1",""],["3-2","æ–­è·¯å™¨","024W3363-545","1",""],["3-3","æ°´æµå¼€å…³","024G00009-014","3",""],["3-3","å‹å·®æ°´æµå¼€å…³","024W33898-000","2",""],["3-3","ç”µç£é˜€çº¿åœˆ","025W42531-000","1",""],["3-3","ç”µç£çº¿åœˆ","025-28989-000","1",""],["3-3","ç”µç£é˜€","025-47112-000","1",""],["3-3","è§†æ¶²é•œ","026-37571-000","1",""],["3-3","ç”µç£é˜€","030-21946-017-","2",""],["3-3","æ°´æ³µå®‰è£…é’£é‡‘","371W06644-391","1",""],["3-4","ä¸»æ¿","031-03630-601","1",""],["3-4","ä¸»æ¿","331-02506-601","1",""],["3-4","è¶é˜€","022-10642-004","1",""],["3-4","ç”µå­è†¨èƒ€é˜€","025-45331-003","1",""],["3-5","æ§åˆ¶æ¿","025W43786-548","1",""],["3-5","è½´å°","029-24762-000","1",""],["4-1","æ˜¾ç¤ºå±","025W00088-000","1",""],["4-1","ä¸»æ§æ¿","024W33782-000","1",""],["4-1","CPUæ¨¡å—","025W39725-000","2",""],["4-1","ä¸»æ¿å¥—ä»¶","031-00947-000","1",""],["4-1","åŠ çƒ­å™¨","025W48737-201","3",""],["4-1","æ§åˆ¶å™¨","024G00019-027","1",""],["4-2","é£å‹å·®è¡¨","024G00015-010","3",""],["4-2","æ„Ÿæ¸©å…ƒä»¶","022W12605-102","1",""],["4-2","æ¸©åº¦ä¼ æ„Ÿå™¨","024W33669-000","1",""],["4-2","æ¸©åº¦ä¼ æ„Ÿå™¨","025W39721-001","2",""],["4-2","é›†æ§å™¨","025W45462-029","1",""],["4-2","ç”µæº","025-34111-000","1",""],["4-2","å‹åŠ›ä¼ æ„Ÿå™¨","025W28678-101","4",""],["4-2","æ‰§è¡Œå™¨æ”¹è£…ä»¶","025W48243-070","1",""],["4-3","æ§åˆ¶æ¿","025W43786-549","1",""],["4-3","è¾“å‡ºæ¿","025W43786-550","1",""],["4-3","è¾“å‡ºæ¿","025W43786-551","1",""],["4-3","æ²¹æ³µ","026-46984-000","1",""],["4-3","ä¸»æ¿","331-02506-601","1",""],["4-3","æ§åˆ¶æ¿","025W43786-548","1",""],["4-3","å¯¼å¶é©¬è¾¾","025-48232-000","1",""],["4-3","ä¸»æ¿","331-02506-602","1",""],["4-4","I/Oæ¿","031W01743-002","2",""],["4-4","æ‰§è¡Œå™¨","025W38178-001","2",""],["4-4","æ²¹è¿‡æ»¤å™¨","026W32831-000","2",""],["4-4","å‹åŠ›ä¼ æ„Ÿå™¨","025W43790-000","1",""],["4-4","å‹åŠ›ä¼ æ„Ÿå™¨","025W43790-112","1",""],["4-4","ç»§ç”µå™¨","024W30441-000","1",""],["4-4","å•å‘é˜€","025G00039-095","1",""],["4-4","EXVé©±åŠ¨æ¿","024W33786-000","1",""],["4-5","è½´å°","364-47950-000","2",""],["4-5","æ©¡èƒ¶å«","028W18169-002","40",""],["5-1","å‚¨èƒ½æ¨¡å—","371W09552-902","2",""],["5-2","ç”µèƒ½ç®±","SHQNJ-C-003","",""],["5-2","æ•°å­—é’³å½¢åŠŸç‡è®¡","","2",""],["5-2","ç½‘å…³ç®±","","1",""],["5-3","ç»ç¼˜æµ‹è¯•ä»ª","","1",""],["5-3","ç”µèƒ½ç®±","SHQNJ-C-003","1",""],["5-3","ç”µèƒ½ç®±","","1",""],["5-4","è¶…å£°æ³¢æµé‡ä»ª","","2",""],["6é¡¶","ç”µè§†æœº","","1",""],["6é¡¶","å˜é¢‘æŸœå……ç”µå™¨","","1",""],["6-1","æ»‘é˜€ä½ç½®ä¼ æ„Ÿå™¨","371-05520-001","1",""],["6-1","æ°´å®¤å¯†å°æ¡","","3m",""],["6-1","IGBT","","1",""],["6-1","å‹åŠ›å¼€å…³","025W47072-101","1",""],["6-2","ä¸¤ä½ä¸‰é€šé˜€","","2",""],["6-3","åŠ æ²¹æ³µæ²¹ç®¡","","1",""],["6-3","æ¸©åº¦ç®±","SHQNJ-C-003","1",""],["6-4","é’¢ç“¶æ‰‹é˜€","","2",""],["6-4","çˆ†ç ´ç‰‡","","2",""],["6-5","ç”µèƒ½ä»ª","SHQNJ-C-19","1",""],["6-5","èƒ½é‡æ ¸æŸ¥ä»ª","","",""],["7-1","ç”µç£é˜€","022W10820-000","1",""],["7-1","é©¬è¾¾ä¿æŠ¤å™¨","024W31517-005","1",""],["7-2","è”æœºæ¿","025G00033-062","1",""],["7-2","æ¸©åº¦ä¼ æ„Ÿå™¨","035G00037-036","4",""],["7-2","æ¸©åº¦ä¼ æ„Ÿå™¨","035G00037-034","2",""],["7-2","æ¸©åº¦ä¼ æ„Ÿå™¨","025W48195-101","1",""],["7-2","é˜€","022W01378-000","1",""],["7-2","çƒ­ç»§ç”µå™¨","025G00007-005","4",""],["7-2","æ¸©åº¦ä¼ æ„Ÿå™¨","025G00037-011","1",""],["7-2","æ¸©æ§å™¨","025G00013-013","1",""],["7-2","æ§åˆ¶å™¨","4683-TTM-2F","1",""],["7-2","æ¸©åº¦ä¼ æ„Ÿå™¨","025W29964-001","1",""],["7-2","æ²¹æ»¤èŠ¯","026-35601-000","2",""],["7-2","ç”µç£é˜€","025-42378-000","1",""],["7-2","ç”µç£é˜€ä½“","025-26270-012","1",""],["7-2","å«ç‰‡","228-09410-800","2",""],["7-2","æ¸©åº¦ä¼ æ„Ÿå™¨","025L02246-000","1",""],["7-2","å‹åŠ›ä¼ æ„Ÿå™¨","025-28678-104","1",""],["7-2","å‹åŠ›ä¼ æ„Ÿå™¨","P499VBS-404C","1",""],["7-2","é«˜å‹å¼€å…³","025L01401-000","1",""],["7-2","æ¸©åº¦ä¼ æ„Ÿå™¨","025W48195-001","1",""],["7-2","PRVç”µæœºè‡‚","064W51926-000","1",""],["7-2","çƒ­ç»§ç”µå™¨","025G00007-038","6",""],["7-2","ç”µæµäº’æ„Ÿå™¨","025W21173-003","1",""],["7-2","äº¤æµæ¥è§¦å™¨","024G00016-008","1",""],["7-2","ç”µæºä¿æŠ¤å™¨","025W43808-500","1",""],["7-2","å¹²ç‡¥è¿‡æ»¤å™¨","026-37563-000","2",""],["7-2","å››é€šé˜€","951A0113H02","1",""],["7-2","æ´»å¡é’¢å¥—","064W49654-000","2",""],["7-3","ABBæ¥è§¦å™¨","A210-30","3",""],["7-3","å¯†å°ç¯","064-47785-000","1",""],["7-3","æ­¢æ¨ç¯","064-47770-000","1",""],["7-3","æ­¢æ¨ç¯","064-47547-000","1",""],["7-3","æ»‘åŠ¨è½´æ‰¿","064-47544-000","1",""],["7-3","æ»‘åŠ¨è½´æ‰¿","064-47541-000","1",""],["7-3","æ»‘åŠ¨è½´æ‰¿","064-47542-000","1",""],["7-3","æ»‘åŠ¨è½´æ‰¿","064-47543-000","1",""],["7-3","æ­¢æ¨è½´æ‰¿","064-48283-000","1",""],["8-1","é©¬è¾¾ä¿æŠ¤å™¨","024W31517-100","1",""],["8-2","è¾“å‡ºæ¨¡å—","111Q0281061","6",""],["8-2","è¾“å…¥æ¨¡å—","333Q0000789","3",""],["8-2","æ¥å¤´","164929","12",""],["8-2","å•å‘é˜€","956A0053H02","16",""],["8-3","ç”µæº","025-34111-000","1",""],["8-3","ä¸»æ¿","331-03630-601","1",""],["8-3","æ¸©åº¦æ¢å¤´","025W29964-001","1",""],["8-3","å‹åŠ›ä¼ æ„Ÿå™¨","025-28678-104","1",""],["8-3","å¡æ‰£","5760516","5",""],["8-3","å‹åŠ›ä¼ æ„Ÿå™¨","025W40088-000","1",""],["8-3","å‹åŠ›ä¼ æ„Ÿå™¨","025W43790-000","1",""],["8-3","æ²¹å¼•å°„å—","026W46156-000","1",""],["8-3","å¯¼å¶é©¬è¾¾","48234","1",""],["8-3","æ˜¾ç¤ºå±","031-03441-000","1",""],["8-4","æ²¹æ³µ","","2",""],["8-4","è”è½´å™¨å¼¹ç°§ç‰‡","","6",""],["9-1","æ¸©åº¦ä¼ æ„Ÿå™¨","025W00093-010","1",""],["9-2","å‹åŠ›å¼€å…³","024G00013-006","2",""],["9-2","å‹åŠ›å¼€å…³","025L02955-001","1",""],["9-2","æµ‹æ¸©å¥—ç®¡","092W14052-001","1",""],["9-2","ä½å‹å¼€å…³","024G00013-007","1",""],["9-2","é˜€","022W11216-002","1",""],["9-2","YCAEä¸»æ¿","025G00056-109","1",""],["9-2","æ¥è§¦å™¨","025W42500-305","1",""],["9-2","å‹åŠ›æ§åˆ¶å™¨","024G00013-035","3",""],["9-2","æ¸©åº¦ä¼ æ„Ÿå™¨","025G00037-040","3",""],["9-2","ELINK","","1",""],["9-2","å‹åŠ›å¼€å…³","024G00013-038","1",""],["9-2","æ²¹åŠ çƒ­å™¨","015G00002-002","1",""],["9-2","æ°´æµå¼€å…³","024G00009-002","2",""],["9-2","I/Oæ¿","024W33789-800","1",""],["9-2","ä¸‰ç›¸ä¿æŠ¤å™¨","025G00015-005","1",""],["9-2","ç”µç£é˜€","025-35150-104","1",""],["9-2","ä¿é™©ä¸","024G00036-004","1",""],["9-2","å¯†å°ç¯","064-47586-000","1",""],["9-2","è½´å°","464-47820-000","1",""],["9-4","æ§åˆ¶ä¸­å¿ƒ","","1",""],["10-1","å¹²ç‡¥è¿‡æ»¤å™¨","026-32839-000","4",""],["10-1","ç”µæµäº’æ„Ÿå™¨","025W21173-103","2",""],["10-1","ç”µæµäº’æ„Ÿå™¨","025W21173-003","1",""],["10-1","è¿‡æ»¤å™¨","023-20878-001","1",""],["10-1","çƒ­åŠ›è†¨èƒ€é˜€","022W11976-012","1",""],["10-1","å¼¹ç°§","022-10189-000","1",""],["10-1","å‹åŠ›ä¼ æ„Ÿå™¨","025L01917-000","1",""],["10-1","çƒ­åŠ›è†¨èƒ€é˜€","022-10961-004","1",""],["10-1","è†¨èƒ€é˜€èŠ¯","022-10184-000","1",""],["10-1","å¹²ç‡¥è¿‡æ»¤å™¨","026-32841-000","3",""],["10-1","æ²¹æ»¤","392-10719-000","2",""],["10-1","æ²¹æ»¤","026-32386-000","1",""],["10-1","èºæ¯","023W18287-000","2",""],["10-1","ç»§ç”µå™¨æ¿","025W43786-551","1",""],["10-1","çƒ­åŠ›è†¨èƒ€é˜€","KT-83-VCP100","2",""],["10-1","æ’æ¸©å¥—ä»¶","362G52475A032","1",""],["10-1","æ²¹æ»¤","026W36838-000","1",""],["10-1","çº¿åœˆ","025-16572-001","1",""],["10-2","ç”µå­è†¨èƒ€é˜€","","1",""],["10-3","æ¸©åº¦ä¼ æ„Ÿå™¨","025G00037-011","1",""],["10-3","è½´æ‰¿","029-22451-000","1",""],["10-3","ç»§ç”µå™¨ABB","1161867","1",""],["10-3","YKé”®ç›˜","5443010","1",""],["11-1","å¼¹ç°§","534B0020H01","1",""],["11-1","å¼¹ç°§","534B0036H01","1",""],["11-1","å¼¹ç°§","534C0595G04","1",""],["11-2","é˜€","025-42245-015","1",""],["11-2","è¿‡æ»¤å™¨","026W51712-000","2",""],["11-3","å¹²ç‡¥è¿‡æ»¤å™¨","026-28173-000","5",""],["11-3","æ²¹æ»¤èŠ¯","026W36838-000","1",""],["11-3","åŠ çƒ­å¸¦","025G00042-036","6",""],["11-3","å¹²ç‡¥è¿‡æ»¤å™¨","026-13508-000","6",""],["11-3","è†¨èƒ€é˜€ä½“","022-10183-000","1",""],["11-4","æ‰‹è½®æˆªæ­¢é˜€","022W11216-006","2",""],["11-4","æ°´æ³µ","","3",""],["12-1","æ‰‹åŠ¨é˜€","022W10086-106","1",""],["12-2","è½´å°","534C0701H06","1",""],["12-2","å¼•å°„å—","026-35381-000","1",""],["12-3","ç©ºå¼€","","5",""],["12-3","YFSæ»‘é˜€ç»„ä»¶","","1",""],["12-4","ç§°","","1",""],["12-4","å˜å‹å™¨","","1",""],["13-1","æ²¹è§†é•œ","026-17581-000","3",""],["13-1","æ°´æµå¼€å…³","","2",""],["13-1","æ˜¾ç¤ºå±","025W42576-001","2",""],["13-1","å£°å…‰æŠ¥è­¦å™¨","","1",""],["13-1","å¯¼å¶é©¬è¾¾","025-48233-000","1",""],["13-2","çº¿åœˆ","023-0088-00","2",""],["13-2","é˜€","010-0125-00","2",""],["13-2","å®‰å…¨é˜€","022-10045-000","2",""],["13-2","PRVè½´","364-29573-000","1",""],["13-2","è½´æ‰¿","029-22450-000","1",""],["13-2","å®‰å…¨é˜€","022W10079-000","1",""],["13-2","å®‰å…¨é˜€","022W12520-000","4",""],["13-2","å®‰å…¨é˜€","022W09505-000","1",""],["13-2","æ¥çº¿æ¿","064W52142-000","1",""],["13-2","ç»§ç”µå™¨","333Q0000897","2",""],["13-2","ç»§ç”µå™¨","333Q0001095","1",""],["13-2","æ¥çº¿ç›’ç›–","","1ç®±",""],["13-3","å«ç‰‡","064-47451-000","1",""],["13-3","å«ç‰‡","028W15712-002","1",""],["13-3","å«ç‰‡","028W15787-007","1",""],["13-3","å«ç‰‡","028-15075-062","3",""],["13-3","å«ç‰‡","028W15712-007","1",""],["13-3","å«ç‰‡","028W14166-013","1",""],["13-3","å«ç‰‡","028-15075-061","1",""],["13-4","æ°´æ³µ","","2",""],["æœªè®°å½•","Kæ²¹","","28",""],["æœªè®°å½•","Sæ²¹","","10",""],["æœªè®°å½•","13#æ²¹","","2",""],["æœªè®°å½•","R134a","","28",""],["æœªè®°å½•","R22","","2",""]
];

// 2. å€Ÿå‡ºæµæ°´è´¦è®°å½• [å€Ÿå‡ºæ—¥æœŸ, é›¶ä»¶å, é›¶ä»¶å·, æ•°é‡, é¢†ç”¨äºº, æ˜¯å¦å½’è¿˜(0/1), åŸå§‹åº“ä½]
let borrowRecords = JSON.parse(localStorage.getItem('borrow_records')) || [];

function syncStorage() {
    localStorage.setItem('parts_db', JSON.stringify(database));
    localStorage.setItem('borrow_records', JSON.stringify(borrowRecords));
}

function togglePanel(id) {
    const el = document.getElementById(id);
    el.style.display = el.style.display === 'block' ? 'none' : 'block';
}

// ä¿å­˜æ–°å½•å…¥
function savePart() {
    const loc = document.getElementById('newLoc').value.trim();
    const name = document.getElementById('newName').value.trim();
    const no = document.getElementById('newNo').value.trim();
    const qty = document.getElementById('newQty').value.trim();
    const note = document.getElementById('newNote').value.trim();

    if(!loc || !name) { alert("åº“ä½å’Œåç§°ä¸èƒ½ä¸ºç©º"); return; }

    database.unshift([loc, name, no, qty, note]);
    syncStorage();
    alert("å½•å…¥æˆåŠŸï¼");
    document.getElementById('inputPanel').style.display = 'none';
}

// å€Ÿå‡ºæ“ä½œ
function borrowPart(dbIndex) {
    const item = database[dbIndex];
    const currentQty = parseInt(item[3]) || 0;
    
    if (currentQty <= 0) { alert("åº“å­˜ä¸è¶³ï¼"); return; }

    const person = prompt(`å€Ÿå‡ºã€${item[1]}ã€‘\nå½“å‰åº“å­˜: ${currentQty}\nè¯·è¾“å…¥é¢†ç”¨äººå§“åï¼š`);
    if (!person) return;

    const bNum = prompt("è¯·è¾“å…¥å€Ÿå‡ºæ•°é‡ï¼š", "1");
    const num = parseInt(bNum);
    if (isNaN(num) || num <= 0 || num > currentQty) { alert("è¾“å…¥æ•°é‡æ— æ•ˆæˆ–è¶…è¿‡åº“å­˜"); return; }

    // 1. æ›´æ–°åº“å­˜
    database[dbIndex][3] = currentQty - num;

    // 2. å¢åŠ ä¸€æ¡ç‹¬ç«‹çš„å€Ÿå‡ºè®°å½•
    const date = new Date().toLocaleDateString();
    // ç»“æ„ï¼šæ—¥æœŸ, åç§°, é›¶ä»¶å·, æ•°é‡, é¢†ç”¨äºº, æ˜¯å¦å·²è¿˜, åŸå§‹åº“å­˜ç´¢å¼•
    borrowRecords.unshift([date, item[1], item[2], num, person, 0, dbIndex]);

    syncStorage();
    handleSearchInput();
    alert("å€Ÿå‡ºæˆåŠŸï¼");
}

// å½’è¿˜æ“ä½œ
function returnPart(recordIndex) {
    const record = borrowRecords[recordIndex];
    if (record[5] === 1) return; // å·²å½’è¿˜

    if (confirm(`ç¡®è®¤å½’è¿˜: ${record[4]} é¢†ç”¨çš„ ${record[3]} ä¸ª ${record[1]}ï¼Ÿ`)) {
        // 1. å¯»æ‰¾åŸé›¶ä»¶ï¼ˆé€šè¿‡åç§°å’Œé›¶ä»¶å·åŒ¹é…ï¼Œé˜²æ­¢ç´¢å¼•å˜åŒ–ï¼‰
        const dbIdx = database.findIndex(p => p[1] === record[1] && p[2] === record[2]);
        
        if (dbIdx !== -1) {
            database[dbIdx][3] = (parseInt(database[dbIdx][3]) || 0) + record[3];
        } else {
            alert("åŸé›¶ä»¶ä¿¡æ¯åœ¨åº“ä¸­å·²ä¸å­˜åœ¨ï¼Œæ•°é‡å°†æ— æ³•è‡ªåŠ¨å›åŠ ï¼Œä»…æ ‡è®°å½’è¿˜çŠ¶æ€ã€‚");
        }

        // 2. æ ‡è®°è®°å½•ä¸ºå·²å½’è¿˜
        borrowRecords[recordIndex][5] = 1;
        syncStorage();
        showBorrowList();
    }
}

// æœç´¢é€»è¾‘
function handleSearchInput() {
    const q = document.getElementById('searchInput').value.trim().toLowerCase();
    const container = document.getElementById('tableContainer');
    const tbody = document.getElementById('tableBody');
    const thead = document.getElementById('tableHead');

    if(!q) { container.style.display = 'none'; return; }

    const results = database.filter(item => 
        item[0].toLowerCase().includes(q) || 
        item[1].toLowerCase().includes(q) || 
        item[2].toLowerCase().includes(q)
    );

    container.style.display = 'block';
    thead.innerHTML = `<tr><th>åº“ä½</th><th>åç§°</th><th>é›¶ä»¶å·</th><th>æ•°é‡</th><th>æ“ä½œ</th></tr>`;
    
    if (results.length === 0) {
        tbody.innerHTML = '<tr><td colspan="5" style="text-align:center;padding:30px;color:#999">æœªæ‰¾åˆ°ç›¸å…³é›¶ä»¶</td></tr>';
    } else {
        tbody.innerHTML = results.map(item => {
            const realIdx = database.indexOf(item);
            return `
                <tr>
                    <td><span class="loc-tag">${highlight(item[0],q)}</span></td>
                    <td>${highlight(item[1],q)}</td>
                    <td>${highlight(item[2],q)}</td>
                    <td><b>${item[3]}</b></td>
                    <td><button class="btn-blue" style="padding:5px 10px" onclick="borrowPart(${realIdx})">å€Ÿå‡º</button></td>
                </tr>
            `;
        }).join('');
    }
}

// æ˜¾ç¤ºå€Ÿå‡ºæ˜ç»†ï¼ˆæµå¼è®°å½•ï¼‰
function showBorrowList() {
    const container = document.getElementById('tableContainer');
    const tbody = document.getElementById('tableBody');
    const thead = document.getElementById('tableHead');
    
    container.style.display = 'block';
    thead.innerHTML = `<tr><th>æ—¥æœŸ</th><th>é›¶ä»¶/ç¼–å·</th><th>æ•°é‡</th><th>é¢†ç”¨äºº</th><th>çŠ¶æ€</th></tr>`;

    if (borrowRecords.length === 0) {
        tbody.innerHTML = '<tr><td colspan="5" style="text-align:center;padding:30px;color:#999">æš‚æ— å€Ÿå‡ºè®°å½•</td></tr>';
    } else {
        tbody.innerHTML = borrowRecords.map((rec, idx) => `
            <tr class="${rec[5] === 1 ? 'status-returned' : ''}">
                <td>${rec[0]}</td>
                <td>${rec[1]}<br><small>${rec[2]}</small></td>
                <td>${rec[3]}</td>
                <td>${rec[4]}</td>
                <td>
                    ${rec[5] === 1 ? 'âœ… å·²å½’è¿˜' : `<button class="btn-return" onclick="returnPart(${idx})">ç¡®è®¤å½’è¿˜</button>`}
                </td>
            </tr>
        `).join('');
    }
}

function showTotalStats() {
    let totalTypes = database.length;
    let totalItems = database.reduce((sum, item) => sum + (parseFloat(item[3]) || 0), 0);
    alert(`ğŸ“Š ä»“åº“ç»Ÿè®¡æŠ¥å‘Šï¼š\n----------------------\nâ— é›¶ä»¶ç§ç±»ï¼š${totalTypes} ç§\nâ— æ€»è®¡æ•°é‡ï¼š${totalItems} ä»¶\nâ— æœªå½’è¿˜è®°å½•ï¼š${borrowRecords.filter(r=>r[5]===0).length} æ¡`);
}

function highlight(text, q) {
    if(!q) return text;
    const regex = new RegExp(`(${q})`, "gi");
    return text.replace(regex, '<span class="highlight">$1</span>');
}
</script>

</body>
</html>
